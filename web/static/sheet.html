<html>
<head>
    <title>Senechal</title>
    <script src="jquery-3.5.1.min.js"></script>
    <link rel="stylesheet" href="jquery-ui-1.12.1.custom/jquery-ui.css">
    <link rel="stylesheet" href="css/senechal.css">
    <script src="jquery-ui-1.12.1.custom/jquery-ui.js"></script>
    <script>

traits = [
    [ 'Chaste', 'Lustful' ],
    [ 'Energetic', 'Lazy' ],
    [ 'Forgiving', 'Vengeful' ],
    [ 'Generous', 'Selfish' ],
    [ 'Honest', 'Deceitful' ],
    [ 'Just', 'Arbitrary' ],
    [ 'Merciful', 'Cruel' ],
    [ 'Modest', 'Proud' ],
    [ 'Prudent', 'Reckless' ],
    [ 'Spiritual', 'Worldly' ],
    [ 'Temperate', 'Indulgent' ],
    [ 'Trusting', 'Suspicious' ],
    [ 'Valorous', 'Cowardly' ],
    ]


skills = []
passions = []

function refreshdata(id) {
    $.get( "../json?id="+id,function( data ) {
      $('.skill .ui-icon').hide()
      $('#traits .ui-icon-check').hide()
      $('#passions .ui-icon').hide()
      char = data.char
      $( "#cid" ).val(id)
      $( "#json" ).val(JSON.stringify(char, null, 2))

      $('#name').text(char['name'])
      if  ('url' in char) {
        $('#charimg').attr('src',char['url'])
        $('#charimg').show()
      } else {
        $('#charimg').hide()
      }

      $('#main').html('')
      if ('main' in char) {
          for (const [n, v] of Object.entries(char['main'])) {
            $('#main').append('<li><span class="gold">'+n+'</span> '+v+'</li>');
          }
      }
      $('#left').html('')
      if ('stats' in char) {
          $('#statistics').html(
          '<li><span class="gold">SIZ</span> '+char['stats']['siz']+'</li>'
          +'<li><span class="gold">DEX</span> '+char['stats']['dex']+'</li>'
          +'<li><span class="gold">STR</span> '+char['stats']['str']+'</li>'
          +'<li><span class="gold">CON</span> '+char['stats']['con']+'</li>'
          +'<li><span class="gold">APP</span> '+char['stats']['app']+'</li>'
          +'<li><span class="gold">Damage</span> <em> (STR+SIZ)/6=</em> <strong>'+Math.round((char['stats']['str']*1+char['stats']['siz']*1)/6)+'d6 </strong></li>'
          +'<li><span class="gold">Healing Rate</span> <em> (STR+CON)/10=</em> <strong>'+Math.round((char['stats']['con']*1+char['stats']['siz']*1)/10)+' </strong></li>'
          +'<li><span class="gold">Move Rate</span> <em> (STR+DEX)/10=</em> <strong>'+Math.round((char['stats']['dex']*1+char['stats']['siz']*1)/10)+' </strong></li>'
          +'<li><span class="gold">Total Hitpoints</span> <em> (SIZ+CON)=</em> <strong>'+Math.round((char['stats']['siz']*1+char['stats']['con']*1))+' </strong></li>'
          +'<li><span class="gold">Unconscious</span> <em> (HP/4)=</em> <strong>'+Math.round((char['stats']['con']*1+char['stats']['siz']*1))+' </strong></li>'
          );
          $('#hp').html(Math.round((char['stats']['siz']*1+char['stats']['con']*1)))
      }
      if ('events' in data) {
          glory = 0;
          for (event in data['events']) {
            glory+=data['events'][event]['glory'];
          }
          $('#glory').html(glory);
      }
      if ('skills' in char) {
          skillcount = 0;
          skills = []
          for (const [sgn, sgv] of Object.entries(char['skills'])) {
              for (const [sn, sv] of Object.entries(sgv)) {
                  $(sgn=='Other'?'#skills':'#combat').append('<li id="skill_'+skillcount+'"><span class="gold">'+sn+'</span> '+sv+'<span class="ui-icon ui-icon-check"></span></li>');
                  skills[skillcount++]='skills.'+sgn+'.'+sn;
              }
          }
      }
      $('#passions').html('')
      if ('passions' in char) {
          count = 0;
          passions = []
          for (const [pn, pv] of Object.entries(char['passions'])) {
              $('#passions').append('<li id="passion_'+count+'"><span class="gold">'+pn+'</span> '+pv+'<span class="ui-icon ui-icon-check"></span></li>');
              passions[count++]='passions.'+pn;
          }
      }
      if ('traits' in char) {
       $('#traits').show();
         for (const [tn, tv] of Object.entries(char['traits'])) {
            $('#trait_'+tn+' div:nth-child(2)').text(tv)
            $('#trait_'+tn+' div:nth-child(6)').text(20-tv*1)
         }
      } else {
       $('#traits').hide();
      }
      $('#description').html('')
      if ('description' in char) {
        $('#description').html(char['description'].replace("\n", "<br/>"))
      }
      $('#longdescription').html('')
      if ('longdescription' in char) {
        $('#longdescription').html(char['longdescription'].replace("\n", "<br/>"))
      }
     $('.ui-icon-check').hide()
     $('#passions .ui-icon').hide()
     if ('marks' in data) {
         for (i in skills) {
            if (data['marks'].includes(skills[i].replace(/.*\./g, ""))) {
                console.log(skills[i])
                $('#skill_'+i+' .ui-icon').show()
            }
         }
         for (i in passions) {
            if (data['marks'].includes(passions[i].replace(/.*\./g, ""))) {
                console.log(passions[i])
                $('#passion_'+i+' .ui-icon').show()
            }
         }
         for (i in traits) {
            if (data['marks'].includes(traits[i][0])) {
              $('#trait_'+traits[i][0].toLowerCase().substring(0,3)+' div.div-table-col:nth-child(1) .ui-icon').show()
            }
            if (data['marks'].includes(traits[i][1])) {
              $('#trait_'+traits[i][0].toLowerCase().substring(0,3)+' div.div-table-col:nth-child(7) .ui-icon:last-child').show()
            }
         }
     }
    });
}
  $( function() {
     $('.ui-icon-check').hide();
     $('#passions .ui-icon').hide();
     refreshdata(32);
  } );
  </script>
</head>
<body>

<div class="row">
    <div class="col-1"><h2 id="name">Name</h2>
        <ul id='main'>
            <li><span class="gold">Age:</span>  #age</li>
            <li><em>7th son</strong></li>
            <li><span class="gold">Homeland</span>:  #Homeland</li>
            <li><span class="gold">Culture</span>:  #Culture</li>
            <li><span class="gold">Religion</span>:  #Religion</li>
            <li><span class="gold">Lord:</span>  Lord</li>
            <li><span class="gold">Current Class: </span> Knight</li>
            <li><span class="gold">Current Home: </span> Current Home</li>
            <li><span class="gold">Family Characteristics: </span>FamilyCharacteristics</li>
        </ul>

    </div> <!-- 33.33% -->
    <div class="col-1"><h2>Statistics</h2>
        <ul id="statistics">
            <li><span class="gold">SIZ</span>:  '+char['stats']['siz']+'   </li>
            <li><span class="gold">DEX:</span>  15</li>
            <li><span class="gold">STR: </span> 12</li>
            <li><span class="gold">CON(+3): </span> 11 <em>(Major Wound)</strong></li>
            <li><span class="gold">APP: </span> 14 <em>(14+1 at start, got wounded)</strong></li>
            <li><span class="gold">Damage </span><em>(STR+SIZ)/6</em><strong><em> =</em> </strong> <strong>4d6</strong></li>
            <li><span class="gold">Healing Rate</span> <em>(STR+CON)/10</em><strong><em> =</em>  2</strong></li>
            <li><span class="gold">Movement Rate</span> <em>(STR+DEX)/10 =</em>  <strong>3</strong></li>
            <li><span class="gold">Total Hitpoints</span> <em>(SIZ+CON)= </em> <strong>21</strong></li>
            <li><span class="gold">Unconscious</span> <em>(HP/4)=</em>  <strong>6</strong></li>
        </ul>

    </div> <!-- 33.33% -->
    <div class="col-1">
        <div style="text-align: center"> <img class="Image-Frame" id='charimg' src="" width="200" height="250"> </div>
    </div> <!-- 33.33% -->
</div>

<div class="row">
    <div class="col-1">
        <div class="FontSizeBig">
            <span class="gold">GLORY:</span>
            <span id="glory">?</span>
        </div>
    </div>
    <div class="col-1">
        <div class="FontSizeBig"><img src="https://pappcseperke.hu/wp-content/uploads/2021/02/Codex_Knight_Transparent.png" alt="knight" ></div>
    </div>
    <div class="col-1">
        <div class="FontSizeBig">
            <span class="gold">HP:</span> <span id="hp">?</span>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-1">
        <h2>Personality Traits</h2>
        <div class="div-table traits">
            <div class="div-table-row" id="trait_cha">
                <div class="div-table-col" ><span class="ui-icon ui-icon-check"></span></div>
                <div class="div-table-col" >10</div>
                <div class="div-table-col" >Chaste</div>
                <div class="div-table-col" >/</div>
                <div class="div-table-col pagan">Lustful</div>
                <div class="div-table-col" >10</div>
                <div class="div-table-col" ><span class="ui-icon ui-icon-check"></span></div>
            </div>
            <div class="div-table-row" id="trait_ene">
                <div class="div-table-col" ><span class="ui-icon ui-icon-check"></span></div>
                <div class="div-table-col" >10</div>
                <div class="div-table-col chivalry pagan">Energetic</div>
                <div class="div-table-col" >/</div>
                <div class="div-table-col" >Lazy</div>
                <div class="div-table-col" >10</div>
                <div class="div-table-col" ><span class="ui-icon ui-icon-check"></span></div>
            </div>
            <div class="div-table-row" id="trait_for">
                <div class="div-table-col" ><span class="ui-icon ui-icon-check"></span></div>
                <div class="div-table-col" >10</div>
                <div class="div-table-col chivalry pagan">Forgiving</div>
                <div class="div-table-col" >/</div>
                <div class="div-table-col" >Vengeful</div>
                <div class="div-table-col" >10</div>
                <div class="div-table-col" ><span class="ui-icon ui-icon-check"></span></div>
            </div>
            <div class="div-table-row" id="trait_gen">
                <div class="div-table-col" ><span class="ui-icon ui-icon-check"></span></div>
                <div class="div-table-col" >10</div>
                <div class="div-table-col chivalry pagan">Generous</div>
                <div class="div-table-col" >/</div>
                <div class="div-table-col" >Selfish</div>
                <div class="div-table-col" >10</div>
                <div class="div-table-col" ><span class="ui-icon ui-icon-check"></span></div>
            </div>
            <div class="div-table-row" id="trait_hon">
                <div class="div-table-col" ><span class="ui-icon ui-icon-check"></span></div>
                <div class="div-table-col" >10</div>
                <div class="div-table-col pagan">Honest</div>
                <div class="div-table-col" >/</div>
                <div class="div-table-col" >Deceitful</div>
                <div class="div-table-col" >10</div>
                <div class="div-table-col" ><span class="ui-icon ui-icon-check"></span></div>
            </div>
            <div class="div-table-row" id="trait_jus">
                <div class="div-table-col" ><span class="ui-icon ui-icon-check"></span></div>
                <div class="div-table-col" >10</div>
                <div class="div-table-col chivalry">Just</div>
                <div class="div-table-col" >/</div>
                <div class="div-table-col" >Arbitrary</div>
                <div class="div-table-col" >10</div>
                <div class="div-table-col" ><span class="ui-icon ui-icon-check"></span></div>
            </div>
            <div class="div-table-row" id="trait_mer">
                <div class="div-table-col" ><span class="ui-icon ui-icon-check"></span></div>
                <div class="div-table-col" >10</div>
                <div class="div-table-col chivalry">Merciful</div>
                <div class="div-table-col" >/</div>
                <div class="div-table-col" >Cruel</div>
                <div class="div-table-col" >10</div>
                <div class="div-table-col" ><span class="ui-icon ui-icon-check"></span></div>
            </div>
            <div class="div-table-row" id="trait_mod">
                <div class="div-table-col" ><span class="ui-icon ui-icon-check"></span></div>
                <div class="div-table-col" >10</div>
                <div class="div-table-col chivalry">Modest</div>
                <div class="div-table-col" >/</div>
                <div class="div-table-col pagan">Proud</div>
                <div class="div-table-col" >10</div>
                <div class="div-table-col" ><span class="ui-icon ui-icon-check"></span></div>
            </div>
            <div class="div-table-row" id="trait_pru">
                <div class="div-table-col" ><span class="ui-icon ui-icon-check"></span></div>
                <div class="div-table-col" >10</div>
                <div class="div-table-col" >Prudent</div>
                <div class="div-table-col" >/</div>
                <div class="div-table-col" >Reckless</div>
                <div class="div-table-col" >10</div>
                <div class="div-table-col" ><span class="ui-icon ui-icon-check"></span></div>
            </div>
            <div class="div-table-row" id="trait_spi">
                <div class="div-table-col" ><span class="ui-icon ui-icon-check"></span></div>
                <div class="div-table-col" >10</div>
                <div class="div-table-col" >Spiritual</div>
                <div class="div-table-col" >/</div>
                <div class="div-table-col" >Worldly</div>
                <div class="div-table-col" >10</div>
                <div class="div-table-col" ><span class="ui-icon ui-icon-check"></span></div>
            </div>
            <div class="div-table-row" id="trait_tem">
                <div class="div-table-col" ><span class="ui-icon ui-icon-check"></span></div>
                <div class="div-table-col" >10</div>
                <div class="div-table-col" >Temperate</div>
                <div class="div-table-col" >/</div>
                <div class="div-table-col" >Indulgent</div>
                <div class="div-table-col" >10</div>
                <div class="div-table-col" ><span class="ui-icon ui-icon-check"></span></div>
            </div>
            <div class="div-table-row" id="trait_tru">
                <div class="div-table-col" ><span class="ui-icon ui-icon-check"></span></div>
                <div class="div-table-col" >10</div>
                <div class="div-table-col" >Trusting</div>
                <div class="div-table-col" >/</div>
                <div class="div-table-col" >Suspicious</div>
                <div class="div-table-col" >10</div>
                <div class="div-table-col" ><span class="ui-icon ui-icon-check"></span></div>
            </div>
            <div class="div-table-row" id="trait_val">
                <div class="div-table-col" ><span class="ui-icon ui-icon-check"></span></div>
                <div class="div-table-col" >10</div>
                <div class="div-table-col chivalry">Valorous</div>
                <div class="div-table-col" >/</div>
                <div class="div-table-col" >Cowardly</div>
                <div class="div-table-col" >10</div>
                <div class="div-table-col" ><span class="ui-icon ui-icon-check"></span></div>
            </div>
            <div class="div-table-row">
                <div class="div-table-col" ><span class="ui-icon ui-icon-blank"></span></div>
                <div class="div-table-col" > </div>
                <div class="div-table-col" ></div>
                <div class="div-table-col" ></div>
                <div class="div-table-col "></div>
                <div class="div-table-col" ></div>
                <div class="div-table-col" ><span class="ui-icon ui-icon-blank"></span></div>
            </div>
        </div>
    </div>
    <div class="col-1">
        <h2>Skills</h2>
        <ul id="skills">
        </ul>
    </div>
    <div class="col-1">
        <h2>Combat Skills</h2>
        <ul id="combat">
        </ul>
        <h2>Passions</h2>
        <ul id="passions">
        </ul>
    </div>
</div>
</div>
</body>
</html>
